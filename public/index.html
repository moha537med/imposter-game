<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
  <title>Imposter Game</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">

    <div id="setup">
        <h2>Imposter Game</h2>
        <input id="name" placeholder="ุงุณูู"><br>
        <select id="category">
            <option>ุฃููุงุช</option>
            <option>ูุธุงุฆู</option>
            <option>ุงููุงู ูุตุฑูุฉ</option>
            <option>ุญููุงูุงุช</option>
        </select><br>
        <button onclick="createRoom()">ุฅูุดุงุก ุบุฑูุฉ</button><br><br>
        <input id="roomIdInput" placeholder="Room ID"><br>
        <button onclick="joinRoom()">ุฏุฎูู ุบุฑูุฉ</button>
    </div>

    <div id="room" style="display:none;">
        <h3 id="roomIdDisplay"></h3>
        <h4>ุงููุงุนุจูู:</h4>
        <div id="players"></div>

        <div id="controls">
        <button id="startBtn" onclick="startGame()">ุงุจุฏุฃ ุงููุนุจุฉ</button>
        <button onclick="resetGame()">ุฌููุฉ ุฌุฏูุฏุฉ</button>
    </div>

<h3 id="phaseText"></h3>
</div>

<div id="role" style="display:none;">
<h2 id="roleText"></h2>
</div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let currentRoom=null;
let isHost=false;

function createRoom(){
  const name=document.getElementById("name").value;
  const category=document.getElementById("category").value;
  socket.emit("createRoom",{name,category});
}

function joinRoom(){
  const name=document.getElementById("name").value;
  const roomId=document.getElementById("roomIdInput").value;
  socket.emit("joinRoom",{name,roomId});
}

function startGame(){
  socket.emit("startGame",currentRoom);
}

function startVoting(){
  socket.emit("startVoting",currentRoom);
}

function resetGame(){
  socket.emit("resetGame",currentRoom);
}

socket.on("roomJoined",({roomId,host})=>{
  currentRoom=roomId;
  isHost=host;
  document.getElementById("setup").style.display="none";
  document.getElementById("room").style.display="block";
  document.getElementById("roomIdDisplay").innerText="Room: "+roomId;
  if(!isHost){
    document.getElementById("startBtn").style.display="none";
  }
});

socket.on("playersUpdate",(players)=>{
  const container=document.getElementById("players");
  container.innerHTML="";
  players.forEach(p=>{
    const div=document.createElement("div");
    div.className="player";
    div.innerText=p.name;
    container.appendChild(div);
  });
});

socket.on("role",(data)=>{
  document.getElementById("role").style.display="block";
  if(data.role==="imposter"){
    document.getElementById("roleText").innerText="ุฃูุช Imposter ๐";
  }else{
    document.getElementById("roleText").innerText="ุงููููุฉ: "+data.word;
  }
});

socket.on("phaseUpdate",(phase)=>{
  document.getElementById("phaseText").innerText="ุงููุฑุญูุฉ: "+phase;
});

socket.on("gameResult",(data)=>{
  alert(data.winner);
});

socket.on("errorMessage",(msg)=>{
  alert(msg);
});
</script>

</body>
</html>